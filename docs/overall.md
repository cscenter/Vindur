#Документация к Vindur или кратенький How To
##Введение
Vindur - это встраиваемая NoSQL база данных.

Особенности:

- Позволяет выполнять быстрый поиск по нескольким критериям
- Все операции в оперативной памяти
- Легко установить и настроить
- Полностью написана на Java
- Легко расширяема

##Типичный Use-case
Представьте себе интернет-магазин с миллионом товаров. Каждый товар обладает множеством различных характеристик. Зачастую поиск подходящих товаров производится по нескольким характеристикам, а сами товары могут находиться в разных категориях. Все это требует от поискового движка возможность осуществлять быстрый многокритериальный поиск.

##Описание архитектуры
Vindur базируется на колоночной архитектуре - данные в ней представляют собой совокупность колонок. Это значительно ускоряет выборку по нескольким атрибутам, в отличие от БД с построчной архитектурой. Данные в Vindur представлены как набор документов с уникальным идентификатором. Документ представляет собой совокупность значений атрибутов. Значения каждого атрибута хранятся независимо в специально предназначенных индексах(так называемых хранилищах).

Vindur имеет несколько типов хранилищ, оптимизированных для различных поисковых запросов:

- `StorageExact<T>` - запросы на точное совпадение для типа данных T;
- `StorageRange<T>` - запросы на попадание в диапазон для типа данных T;
- `StorageBucketIntegers` - запросы в диапазоне для целых чисел(оптимизированная версия `StorageRange<Integer>`);
- `StorageLucene` - запросы для полнотекстового поиска;
- `StorageHierarchy` - запросы на вхождение в иерархию;

Все хранилища имеют общий интерфейс `Storage<V, R>`, где `V` - это тип хранимых значений, а `R` - тип запросов к хранилищу. Кроме того, хранилища для поиска по диапазону имеют общий интерфейс `StorageRangeBase<T extends Comparable<T>>`. Соответственно, пльзователь может написать свое хранилище, реализовав соответствующие интерфейсы. Некоторые операции, которые поддерживают хранилища:

- `add(int docId, V value)` - добавление в хранилище информации о документе
- `findSet(R request)` - получение битового массива с номерами документов, соответствующеми запросу 
- `checkValue(int docId, V value, R request)` - проверка соответствия значения атрибута запросу в документе

Кроме того, для каждого хранилища определена величина так называемого веса хранилища - это эмпирическая мера относительной трудоемкости доступа к хранилищу. Подробнее - см. далее
 
Результатом выполнения поискового запроса к хранилищу является битовый массив, где единица в позиции `i` означает, что в документе с таким номером значение атрибута соответствует запросу. Битовые массивы сжимаются с целью экономии памяти, снижения накладных расходов на ввод-вывод и возможности быстрого выполнения логических операций над ними.
  
Процесс выполнения поискового запроса представляет собой следующее:
- Проверка запроса на корректность(соотнесение типа запроса и хранилища)
- Последовательное получение битовых массивов из хранилища и их пересечение
- Конвертация результирующей выборки в список с номерами документов.

Запросы обрабатываются и оптимизируются в процессе выполнения отдельным модулем, так называемым *исполнителем запросов*.  
В Vindur есть четыре исполнителя:

- `DumbExecutor` - последовательно получает битовые массивы из хранилищ и выполняет `AND` для каждого из них;  
- `TinyExecutor` - получает битсеты в порядке возрастания количества документов в хранилище. Если после очередной операции AND получен пустой битсет, исполнитель возвращает пустой результат;  
- `SmartExecutor` - как и `TinyExecutor` сортирует хранилища в порядке возрастания весов, но в некоторый момент времени может начать перебор значений хранилища вместо получения битовых массивов;
- `TunableExecutor` - автоконфигурируемый исполнитель. В отдельном потоке собирает статистику по каждому атрибуту в запросах и выполняет запрос в порядке увеличения среднего время работы `findSet`. Так же в некоторый момент начинает перебор значений вместо получения битовых массивов из хранилища;

Стандартным исполнителем является DumbExecutor.

##Обзор
###Установка
Репозиторий проекта на [GitHub]
###Маленькая задача
Поиск книг в интернет-магазине. При этом каждая книга может обладать атрибутами, которых нет у другой книги.
Также, каждый атрибут может иметь несколько значений, например зачастую авторов бывает несколько. 

###Настройка
Чтобы создать и настроить движок нужно подготовить все хранилища и выбрать исполнитель запросов

    Engine engine = Engine.build()
        .executor(new TinyExecutor())
        .storage("Price", new StorageBucketIntegers())
        .storage("ISBN", new StorageExact())
        .storage("Title", new StorageExact())
        .storage("Author", new StorageExact())
        .storage("Artist", new StorageExact())
        .storage("Annotation", new StorageLucene())
        .init();

###Заполнение
Перед тем как добавить объект в базу данных, нужно создать новый документ:  

    int docId = engine.createDocument();
    
Теперь, обращаясь к документу по id, можно установить его атрибуты, например:

    engine.setValue(docId, "Price", "399");
    engine.setValue(docId, "Author", "Носов Н.");
    engine.setValue(docId, "Title", "Незнайка на луне");
    engine.setValue(docId, "ISBN", "5-699-13348-8");

###Запросы
Каждое хранилище выполняет только один тип запросов. Это значит, что на этапе построения запроса важно каждому
хранилищу передать тот запрос, который оно умеет обрабатывать, например:

    Query query = Query.build()
        .query("Price", new RangeRequest(50, 400))
        .query("Author", "Марк Твен");
        
    List<Integer> foundBooks = engine.executeQuery(query);
    
##О проекте
Студенческий проект в Computer Science Center, 2014-2015 год. Участники:  
Эдгар Жаворонков <edzhavoronkov@gmail.com>  
Сергей Кривохатский <s.krivokhatskiy@gmail.com>  
Андрей Кокорев <a.d.kokorev@gmail.com>  
Павел Чурсин <pch.busy@gmail.com>  

Куратор проекта Филипп Дельгядо <phillip.delgyado@jetbrains.com>

#Примечания к коду
Пока здесь пусто...

[GitHub]:https://github.com/cscenter/Vindur/